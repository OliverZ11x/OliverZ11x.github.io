---
title: SQLAgent 模型知识扩展
tags:
  - SQLAgent
  - 高科数聚
date created: 2024年1月1日,星期一,上午,10:19:52
date modified: 2024年8月7日,星期三,晚上,6:03:41
---
## Supersonic 的实现原理

在提升模型对特定业务知识的理解上，SuperSonic 采用了语义层（Semantic Layer）和模式映射器（Schema Mapper）的概念，这些可以帮助模型更好地理解并准确转换特定的术语或缩写，例如将"BBA"映射到"宝马、奔驰、奥迪"。下面详细介绍这些组件的工作原理及如何应用到提升模型对业务知识的理解：

1. **语义层（Semantic Layer）**：
   - 语义层的主要作用是作为技术术语和业务术语之间的翻译者。在 SuperSonic 中，语义层将数据库中的技术名词（如表名和字段名）转换为更容易被业务用户理解的商业术语（如维度、指标和标签）。这种翻译机制不仅帮助业务用户更好地理解数据，也提升了模型对这些数据的语义理解能力。

2. **模式映射器（Schema Mapper）**：
   - 模式映射器的作用是识别用户查询中的模式元素（如度量、维度、实体、值）并将查询文本与知识库中的模式进行匹配。例如，如果用户查询"BBA 销量"，模式映射器可以帮助模型识别"BBA"是指"宝马、奔驰、奥迪"的销量数据。
   - 通过构建一个包含名称、别名、取值的词典来形成内部的知识库，这有助于减少在输入文本中的 token 使用，提高推理效率，并降低成本。

针对提升模型的理解能力，可以采用以下方法改进或补充现有实现：
- **增强语义层**：进一步丰富和细化语义层中的业务术语和技术术语的映射关系，以提高模型的语义理解能力。
- **优化模式映射器**：改进模式映射的算法，例如通过机器学习方法训练模型以更精确地识别和映射业务术语。
- **数据标注与训练**：通过标注更多业务相关的训练数据来训练模型，使其更好地理解特定的业务术语或缩写。

这些方法不仅适用于 SuperSonic 项目，也可以被广泛应用于其他需要提升特定业务知识理解的 AI 系统中。

## 其他资料

可以参考以下资源来进一步了解如何提升模型对业务术语的理解：

- **领域适应技术**: 研究如何使模型适应特定领域的术语。
- **命名实体识别（NER）技术**: 学习 NER 模型的设计与应用。
- **知识图谱构建**: 使用知识图谱来增强模型的推理能力。
- **最新研究论文**: 查看相关的研究论文，以了解最新的方法和技术。

## 阿里云实验方式

[Copilot生成SQL_数据管理(DMS)-阿里云帮助中心 (aliyun.com)](https://help.aliyun.com/zh/dms/use-copilot-to-generate-sql-statements)

### **管理 SQL 知识**

在使用 DMS Data Copilot 时，为避免 AI 出错，DMS 引入了**知识库**和**相似查询**机制。如下图所示：
![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4106989071/p776687.png)

#### **管理业务知识**

- **生成业务知识**

	知识来源目前有两个：

	- DMS 根据库、表、列元数据和用户的查询历史主动挖掘积累的知识。
	- 用户在与 Copilot 进行交互的过程中，DMS 可向知识库补充用户反馈的信息。

	生成业务知识后，在 Copilot 生成 SQL 时会引用相关的业务知识，并标注出对业务知识的引用。

![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4106989071/p776710.png)

- **验证业务知识**

	在**表详情页**的**业务知识**页签下，您可审核生成的业务知识是否正确，如果正确，您可以将**待审核**或**待验证**的**知识等级**调整为**已验证**。

- **调整业务知识**

	如果业务知识不正确，您可在 SQL 引用的知识库区域，单击**编辑**。
	![](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4106989071/p776345.png)

#### **管理相似 SQL**

Copilot 可以使用历史问题作为参考生成 SQL；Agent 只会使用已验证的知识。

- **生成相似的问题**

	如果您对 Copilot 生成的 SQL 很满意，可以在右下角点赞，点赞后即可保存本次查询记录。后续如果提问类似的问题，Copilot 会参考相似问题生成 SQL。

- **删除已保存的相似问题**

	双击表名称，进入**表详情**页面，在历史问题页签下删除问题。

## **常见问题**

- Q：在对 Copilot 生成的 SQL 较为满意的情况下，为什么需要给 SQL 点赞？
- A：点赞操作可以触发 Copilot 保存 SQL。后续提出相似的问题，能够大大提高回复的准确率。
- Q：当 Copilot 生成的 SQL 与提问不符时，为什么需要补充用户反馈？
- A：补充用户反馈可以提高 Copilot 回复问题的准确率，后续提出的相似问题，基本不会出错。

## 背景

## 向量数据库的崛起

[向量数据库｜一文全面了解向量数据库的基本概念、原理、算法、选型-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/2312534)

在 GPT 模型的限制下，开发者们不得不寻找其他的解决方案，而向量数据库就是其中之一。向量数据库的核心思想是将文本转换成向量，然后将向量存储在数据库中，当用户输入问题时，将问题转换成向量，然后在数据库中搜索最相似的向量和上下文，最后将文本返回给用户。

当我们有一份文档需要 GPT 处理时，例如这份文档是客服培训资料或者操作手册，我们可以先将这份文档的所有内容转化成向量（这个过程称之为 Vector Embedding），然后当用户提出相关问题时，我们将用户的搜索内容转换成向量，然后在数据库中搜索最相似的向量，匹配最相似的几个上下文，最后将上下文返回给 GPT。这样不仅可以大大减少 GPT 的计算量，从而提高响应速度，更重要的是降低成本，并绕过 GPT 的 tokens 限制。

## Agent with RAG

- RAG 可以作为 LangChain（如果它是一个语言处理工具）的一部分，用于提供更加丰富和准确的语言生成能力。
- Agent 可以使用 LangChain 来处理自然语言的任务，比如理解用户输入和生成响应。
- 同时，Agent 也可以利用 RAG 技术来提高其在特定任务（如问答或对话系统）中的性能，尤其是在需要外部知识来支持决策时。

## Enhancing SQL Agents with Retrieval Augmented Generation (RAG)

[Enhancing SQL Agents with Retrieval Augmented Generation (RAG) | by Luc Nguyen | Medium](https://medium.com/@lucnguyen_61589/enhancing-sql-agents-with-retrieval-augmented-generation-rag-e20dbd8bb685)

![[RAG 增强 SQLAgent]]